{% extends "base.html" %}
{% block title %}Importer un PDF – RawDocs{% endblock %}

{% block content %}
<!-- 1) Upload Form -->
<section class="upload-cell">
  <form method="post" class="upload-cell__form" novalidate>
    {% csrf_token %}
    {{ form.pdf_url }}
        <button type="submit" class="upload-cell__enter-btn">
            <i class="fas fa-sign-in-alt"></i> Submit
        </button>
  </form>
</section>

<!-- 2) Metadata Table -->
{% if metadata %}
<section class="card metadata-card">
  <h3><i class="fas fa-info-circle"></i> Métadonnées extraites</h3>
  <table class="metadata-table">
    <tbody>
      <tr><th>Titre</th>              <td>{{ metadata.title|default:"Non spécifié" }}</td></tr>
      <tr><th>Type de document</th>   <td>{{ metadata.type|default:"–" }}</td></tr>
      <tr><th>Langue</th>             <td>{{ metadata.language|default:"–" }}</td></tr>
      <tr><th>Version</th>            <td>{{ metadata.version|default:"–" }}</td></tr>
      <tr><th>URL Source</th>
        <td>
          <a href="{{ metadata.url_source }}" target="_blank" class="source-link">
            <i class="fas fa-external-link-alt"></i>
            {{ metadata.url_source }}
          </a>
        </td>
      </tr>
      <tr><th>Source interne</th>     <td>{{ metadata.source|default:"Non spécifiée" }}</td></tr>
      <tr><th>Date de publication</th><td>{{ metadata.publication_date|default:"Non spécifiée" }}</td></tr>
      <tr><th>Contexte</th>
        <td>
          <div class="context-text">
            {{ metadata.context|default:"Aucun contexte fourni" }}
          </div>
        </td>
      </tr>
      <tr><th>Pays</th>               <td>{{ metadata.country|default:"–" }}</td></tr>
    </tbody>
  </table>
</section>
{% endif %}

<!-- 3) Text Extract -->
{% if extracted_text %}
<section class="card text-card">
  <h3><i class="fas fa-file-alt"></i> Texte complet extrait</h3>
  <div class="text-card__body">
    <pre>{{ extracted_text }}</pre>
  </div>
  <a href="{% url 'rawdocs:upload' %}" class="btn-outline">
    <i class="fas fa-arrow-left"></i> Nouvel upload
  </a>
</section>
{% endif %}

<!-- 4) Lien vers la liste des documents -->
<section class="upload-cell" style="margin-top:2rem;">
  <a href="{% url 'rawdocs:dashboard' %}#metadata-tab"
     class="upload-cell__enter-btn">
    <i class="fas fa-list"></i> Voir tous les documents
  </a>
</section>


<style>
/* —— Upload cell —— */
.upload-cell {
  display: flex;
  justify-content: center;
  margin: 2rem 0;
}
.upload-cell__form {
  display: flex;
  align-items: center;
  gap: .5rem;
  width: 100%;
  max-width: 500px;
}
.upload-cell__enter-btn {
  background: var(--primary-color);
  color: #fff;
  border: none;
  padding: .5rem .75rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition-all);
  display: flex;
  align-items: center;
  gap: .5rem;
}
.upload-cell__enter-btn:hover {
  background: var(--primary-hover);
}
.upload-cell__input {
  flex: 1;
  padding: .75rem 1rem;
  font-size: 1rem;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  transition: var(--transition-all);
}
.upload-cell__input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}

/* —— Métadonnées —— */
.metadata-card {
  background: var(--surface-color);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  margin-bottom: 2rem;
}
.metadata-card h3 {
  display: flex;
  align-items: center;
  gap: .5rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
}
.metadata-table {
  width: 100%;
  border-collapse: collapse;
}
.metadata-table th,
.metadata-table td {
  padding: .5rem .75rem;
  border-bottom: 1px solid var(--border-color);
}
.metadata-table th {
  text-align: left;
  font-weight: 600;
  width: 25%;
}
.source-link {
  color: var(--primary-color);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: .25rem;
}
.source-link:hover {
  text-decoration: underline;
}
.context-text {
  background: var(--background-color);
  padding: .75rem;
  border-radius: var(--border-radius);
  font-size: .95rem;
  line-height: 1.4;
}

/* —— Texte extrait —— */
.text-card {
  background: var(--surface-color);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  margin-bottom: 2rem;
}
.text-card h3 {
  display: flex;
  align-items: center;
  gap: .5rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
}
.text-card__body {
  max-height: 40vh;
  overflow: auto;
  background: var(--background-color);
  padding: 1rem;
  border-radius: var(--border-radius);
  margin-bottom: 1rem;
}
.text-card__body pre {
  margin: 0;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* —— Bouton secondaire —— */
.btn-outline {
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  padding: .5rem 1rem;
  border: 2px solid var(--primary-color);
  border-radius: var(--border-radius);
  color: var(--primary-color);
  text-decoration: none;
  transition: var(--transition-all);
}
.btn-outline:hover {
  background: var(--primary-color);
  color: #fff;
}
</style>

    <script>
  // existant : gestion des clics sur les onglets…
  // …

  // → Au chargement, si on arrive sur #metadata-tab, on force l’onglet validation
  document.addEventListener('DOMContentLoaded', () => {
    if (location.hash === '#metadata-tab') {
      btnMetadata.click();
      // on remet la page proprement sur l’ancre
      window.scrollTo(0, 0);
    }
  });
</script>

{% endblock %}
