{% extends "base.html" %}
{% block title %}Importer un PDF – RawDocs{% endblock %}

{% block content %}
<!-- 1) Upload Form (URL ou fichier local) -->
<section class="upload-cell">
  <form method="post" enctype="multipart/form-data" class="upload-cell__form" novalidate>
    {% csrf_token %}
    <!-- URL Field -->
    <input
      type="url"
      name="pdf_url"
      placeholder="Entrez l’URL du PDF…"
      value="{{ form.pdf_url.value|default_if_none:'' }}"
      class="upload-cell__input"
    />

    <!-- OR Separator -->
    <span class="upload-cell__or">OU</span>

    <!-- Local File Field -->
    <input
      type="file"
      name="pdf_file"
      accept="application/pdf"
      class="upload-cell__input upload-cell__file-input"
    />

    <button type="submit" class="upload-cell__enter-btn">
      <i class="fas fa-upload"></i> Importer
    </button>
  </form>
</section>

<!-- 2) Metadata Table -->
{% if metadata %}
<section class="card metadata-card">
  <h3><i class="fas fa-info-circle"></i> Métadonnées extraites</h3>
  <table class="metadata-table">
    <tbody>
      <tr><th>Titre</th>              <td>{{ metadata.title|default:"Non spécifié" }}</td></tr>
      <tr><th>Type de document</th>   <td>{{ metadata.type|default:"–" }}</td></tr>
      <tr><th>Langue</th>             <td>{{ metadata.language|default:"–" }}</td></tr>
      <tr><th>Version</th>            <td>{{ metadata.version|default:"–" }}</td></tr>
      <tr>
        <th>URL Source</th>
        <td>
          {% if metadata.url_source %}
          <a href="{{ metadata.url_source }}" target="_blank" class="source-link">
            <i class="fas fa-external-link-alt"></i>
            {{ metadata.url_source }}
          </a>
          {% else %}
            –
          {% endif %}
        </td>
      </tr>
      <tr><th>Source interne</th>     <td>{{ metadata.source|default:"Non spécifiée" }}</td></tr>
      <tr><th>Date de publication</th><td>{{ metadata.publication_date|default:"Non spécifiée" }}</td></tr>
      <tr>
        <th>Contexte</th>
        <td>
          <div class="context-text">
            {{ metadata.context|default:"Aucun contexte fourni" }}
          </div>
        </td>
      </tr>
      <tr><th>Pays</th>               <td>{{ metadata.country|default:"–" }}</td></tr>
    </tbody>
  </table>
</section>
{% endif %}

<!-- 3) Texte Extrait -->
{% if extracted_text %}
<section class="card text-card">
  <h3><i class="fas fa-file-alt"></i> Texte complet extrait</h3>
  <div class="text-card__body">
    <pre>{{ extracted_text }}</pre>
  </div>
  <a href="{% url 'rawdocs:upload' %}" class="btn-outline">
    <i class="fas fa-arrow-left"></i> Nouvel upload
  </a>
</section>
{% endif %}

<!-- 4) Lien vers la liste des documents (Dashboard onglet Validation Métadonnées) -->
<section class="upload-cell" style="margin-top:2rem;">
  <a href="{% url 'rawdocs:dashboard' %}#metadata-tab"
     class="upload-cell__enter-btn">
    <i class="fas fa-list"></i> Voir tous les documents
  </a>
</section>


<style>
/* —— Upload Cell —— */
.upload-cell {
  display: flex;
  justify-content: center;
  margin: 2rem 0;
}
.upload-cell__form {
  display: flex;
  align-items: center;
  gap: .75rem;
  flex-wrap: wrap;
  width: 100%;
  max-width: 600px;
}
.upload-cell__input {
  flex: 1;
  min-width: 200px;
  padding: .75rem 1rem;
  font-size: 1rem;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  transition: var(--transition-all);
}
.upload-cell__file-input {
  padding: .5rem;
}
.upload-cell__input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}
.upload-cell__or {
  font-weight: bold;
  color: var(--text-alt);
  margin: 0 .5rem;
}

/* —— Submit Button —— */
.upload-cell__enter-btn {
  background: var(--primary-color);
  color: #fff;
  border: none;
  padding: .6rem 1.2rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition-all);
  display: flex;
  align-items: center;
  gap: .5rem;
}
.upload-cell__enter-btn:hover {
  background: var(--primary-hover);
}

/* —— Métadonnées —— */
.metadata-card {
  background: var(--surface-color);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  margin-bottom: 2rem;
}
.metadata-card h3 {
  display: flex;
  align-items: center;
  gap: .5rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
}
.metadata-table {
  width: 100%;
  border-collapse: collapse;
}
.metadata-table th,
.metadata-table td {
  padding: .5rem .75rem;
  border-bottom: 1px solid var(--border-color);
}
.metadata-table th {
  text-align: left;
  font-weight: 600;
  width: 25%;
}
.source-link {
  color: var(--primary-color);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: .25rem;
}
.source-link:hover {
  text-decoration: underline;
}
.context-text {
  background: var(--background-color);
  padding: .75rem;
  border-radius: var(--border-radius);
  font-size: .95rem;
  line-height: 1.4;
}

/* —— Texte Extrait —— */
.text-card {
  background: var(--surface-color);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  margin-bottom: 2rem;
}
.text-card h3 {
  display: flex;
  align-items: center;
  gap: .5rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
}
.text-card__body {
  max-height: 40vh;
  overflow: auto;
  background: var(--background-color);
  padding: 1rem;
  border-radius: var(--border-radius);
  margin-bottom: 1rem;
}
.text-card__body pre {
  margin: 0;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* —— Bouton secondaire —— */
.btn-outline {
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  padding: .5rem 1rem;
  border: 2px solid var(--primary-color);
  border-radius: var(--border-radius);
  color: var(--primary-color);
  text-decoration: none;
  transition: var(--transition-all);
}
.btn-outline:hover {
  background: var(--primary-color);
  color: #fff;
}
</style>


<script>
  // Au chargement, si on arrive sur #metadata-tab, on bascule sur l’onglet Validation Métadonnées
  document.addEventListener('DOMContentLoaded', () => {
    if (location.hash === '#metadata-tab' && typeof btnMetadata !== 'undefined') {
      btnMetadata.click();
      window.scrollTo(0, 0);
    }
  });
</script>
{% endblock %}
